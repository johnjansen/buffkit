<div class="container">
    <div class="profile-wrapper">
        <div class="profile-header">
            <h1>My Profile</h1>
            <p class="profile-subtitle">Manage your account information and settings</p>
        </div>

        <div class="profile-content">
            <!-- Profile Overview Card -->
            <div class="profile-card">
                <div class="card-header">
                    <h2>Profile Information</h2>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="toggleEditMode()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        Edit
                    </button>
                </div>

                <div class="card-body">
                    <!-- Display Mode -->
                    <div id="profile-display" class="profile-display">
                        <div class="avatar-section">
                            <div class="avatar-large">
                                <%= if (user.AvatarURL) { %>
                                    <img src="<%= user.AvatarURL %>" alt="Profile picture">
                                <% } else { %>
                                    <div class="avatar-placeholder">
                                        <%= user.FirstName ? user.FirstName[0] : user.Email[0] %>
                                    </div>
                                <% } %>
                            </div>
                            <div class="user-status">
                                <%= if (user.IsVerified) { %>
                                    <span class="badge badge-success">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                        Verified
                                    </span>
                                <% } else { %>
                                    <span class="badge badge-warning">Unverified</span>
                                <% } %>
                                <%= if (user.IsAdmin) { %>
                                    <span class="badge badge-primary">Admin</span>
                                <% } %>
                            </div>
                        </div>

                        <div class="profile-fields">
                            <div class="field-group">
                                <label>Full Name</label>
                                <p class="field-value">
                                    <%= user.FirstName || "" %> <%= user.LastName || "" %>
                                    <%= if (!user.FirstName && !user.LastName) { %>
                                        <span class="text-muted">Not set</span>
                                    <% } %>
                                </p>
                            </div>

                            <div class="field-group">
                                <label>Display Name</label>
                                <p class="field-value">
                                    <%= user.DisplayName || "<span class='text-muted'>Not set</span>" %>
                                </p>
                            </div>

                            <div class="field-group">
                                <label>Email Address</label>
                                <p class="field-value">
                                    <%= user.Email %>
                                    <%= if (!user.IsVerified) { %>
                                        <a href="/resend-verification" class="verify-link">Verify email</a>
                                    <% } %>
                                </p>
                            </div>

                            <div class="field-group">
                                <label>Member Since</label>
                                <p class="field-value">
                                    <%= user.CreatedAt.Format("January 2, 2006") %>
                                </p>
                            </div>

                            <div class="field-group">
                                <label>Last Login</label>
                                <p class="field-value">
                                    <%= if (user.LastLoginAt) { %>
                                        <%= user.LastLoginAt.Format("January 2, 2006 at 3:04 PM") %>
                                    <% } else { %>
                                        <span class="text-muted">Never</span>
                                    <% } %>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Edit Mode -->
                    <form id="profile-edit" class="profile-edit" style="display: none;" action="/profile" method="POST">
                        <%= csrf() %>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="first_name">First Name</label>
                                <input
                                    type="text"
                                    id="first_name"
                                    name="first_name"
                                    class="form-control"
                                    value="<%= user.FirstName %>"
                                    maxlength="100"
                                >
                            </div>

                            <div class="form-group">
                                <label for="last_name">Last Name</label>
                                <input
                                    type="text"
                                    id="last_name"
                                    name="last_name"
                                    class="form-control"
                                    value="<%= user.LastName %>"
                                    maxlength="100"
                                >
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="display_name">Display Name</label>
                            <input
                                type="text"
                                id="display_name"
                                name="display_name"
                                class="form-control"
                                value="<%= user.DisplayName %>"
                                placeholder="How you want to be displayed"
                                maxlength="100"
                            >
                        </div>

                        <div class="form-group">
                            <label for="avatar_url">Avatar URL</label>
                            <input
                                type="url"
                                id="avatar_url"
                                name="avatar_url"
                                class="form-control"
                                value="<%= user.AvatarURL %>"
                                placeholder="https://example.com/avatar.jpg"
                            >
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                            <button type="button" class="btn btn-secondary" onclick="toggleEditMode()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Security Settings Card -->
            <div class="profile-card">
                <div class="card-header">
                    <h2>Security Settings</h2>
                </div>

                <div class="card-body">
                    <div class="security-actions">
                        <div class="action-item">
                            <div class="action-info">
                                <h3>Password</h3>
                                <p>Last changed <%= user.UpdatedAt.Format("January 2, 2006") %></p>
                            </div>
                            <a href="/change-password" class="btn btn-secondary">Change Password</a>
                        </div>

                        <div class="action-item">
                            <div class="action-info">
                                <h3>Active Sessions</h3>
                                <p>Manage your active login sessions</p>
                            </div>
                            <a href="/sessions" class="btn btn-secondary">Manage Sessions</a>
                        </div>

                        <div class="action-item">
                            <div class="action-info">
                                <h3>Two-Factor Authentication</h3>
                                <p>
                                    <%= if (user.TOTPEnabled) { %>
                                        <span class="text-success">Enabled</span>
                                    <% } else { %>
                                        <span class="text-muted">Not enabled</span>
                                    <% } %>
                                </p>
                            </div>
                            <%= if (user.TOTPEnabled) { %>
                                <a href="/2fa/disable" class="btn btn-secondary">Disable 2FA</a>
                            <% } else { %>
                                <a href="/2fa/setup" class="btn btn-secondary">Enable 2FA</a>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Danger Zone Card -->
            <div class="profile-card danger-zone">
                <div class="card-header">
                    <h2>Danger Zone</h2>
                </div>

                <div class="card-body">
                    <div class="danger-actions">
                        <div class="action-item">
                            <div class="action-info">
                                <h3>Delete Account</h3>
                                <p>Permanently delete your account and all associated data</p>
                            </div>
                            <button type="button" class="btn btn-danger" onclick="confirmDeleteAccount()">
                                Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .profile-wrapper {
        max-width: 800px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .profile-header {
        margin-bottom: 40px;
    }

    .profile-header h1 {
        margin: 0 0 8px 0;
        font-size: 32px;
        font-weight: 600;
        color: #333;
    }

    .profile-subtitle {
        color: #666;
        font-size: 16px;
    }

    .profile-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    .profile-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .card-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        color: #333;
    }

    .card-body {
        padding: 24px;
    }

    .avatar-section {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
    }

    .avatar-large {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        overflow: hidden;
        background: #f0f0f0;
    }

    .avatar-large img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .avatar-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-size: 32px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .user-status {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
    }

    .badge-success {
        background: #d4edda;
        color: #155724;
    }

    .badge-warning {
        background: #fff3cd;
        color: #856404;
    }

    .badge-primary {
        background: #cce5ff;
        color: #004085;
    }

    .profile-fields {
        display: grid;
        gap: 20px;
    }

    .field-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .field-group label {
        font-size: 13px;
        font-weight: 500;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .field-value {
        margin: 0;
        font-size: 16px;
        color: #333;
    }

    .text-muted {
        color: #999;
        font-style: italic;
    }

    .verify-link {
        margin-left: 12px;
        color: #4CAF50;
        text-decoration: none;
        font-size: 14px;
    }

    .verify-link:hover {
        text-decoration: underline;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #555;
        font-size: 14px;
    }

    .form-control {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
        transition: border-color 0.15s, box-shadow 0.15s;
    }

    .form-control:focus {
        outline: none;
        border-color: #4CAF50;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    .form-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
    }

    .btn {
        display: inline-block;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        text-align: center;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.15s;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 13px;
    }

    .btn-primary {
        background: #4CAF50;
        color: white;
    }

    .btn-primary:hover {
        background: #45a049;
    }

    .btn-secondary {
        background: #f0f0f0;
        color: #333;
    }

    .btn-secondary:hover {
        background: #e0e0e0;
    }

    .btn-danger {
        background: #e74c3c;
        color: white;
    }

    .btn-danger:hover {
        background: #c0392b;
    }

    .security-actions,
    .danger-actions {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .action-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .action-item:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }

    .action-info h3 {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 500;
        color: #333;
    }

    .action-info p {
        margin: 0;
        font-size: 14px;
        color: #666;
    }

    .text-success {
        color: #4CAF50;
    }

    .danger-zone {
        border: 1px solid #f8d7da;
    }

    .danger-zone .card-header {
        background: #f8d7da;
        border-bottom-color: #f5c6cb;
    }

    .danger-zone .card-header h2 {
        color: #721c24;
    }

    @media (max-width: 640px) {
        .form-row {
            grid-template-columns: 1fr;
        }

        .action-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }

        .avatar-section {
            flex-direction: column;
            text-align: center;
        }
    }
</style>

<script>
function toggleEditMode() {
    const displayMode = document.getElementById('profile-display');
    const editMode = document.getElementById('profile-edit');

    if (displayMode.style.display === 'none') {
        displayMode.style.display = 'block';
        editMode.style.display = 'none';
    } else {
        displayMode.style.display = 'none';
        editMode.style.display = 'block';
    }
}

function confirmDeleteAccount() {
    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
        if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
            // In a real app, this would submit a form or make an API call
            window.location.href = '/account/delete';
        }
    }
}
</script>
